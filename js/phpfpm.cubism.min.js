(function(k){var d=k.phpfpm={};d.url=function(d){this.url=d;this.addQueryString=function(c,b){var a=RegExp("([?|&])"+c+"=.*?(&|#|$)(.*)","gi");a.test(this.url)?this.url=this.url.replace(a,"$1"+c+(b?"="+b:"")+"$2$3"):(a=this.url.split("#"),this.url=a[0]+(-1!==this.url.indexOf("?")?"&":"?")+c,b&&(this.url+="="+b),a[1]&&(this.url+="#"+a[1]));return this};this.toString=function(){return this.url};return this};d.status=function(g,c){this.url=d.url(g).addQueryString("json").toString();this.delay=c;this.data=
{};this.previousData={};this.lastFetch=+new Date;this.fetchNumber=0;this.fetchInProgress=!1;this.fetch=function(b){if(!this.fetchInProgress){this.lastFetch=+new Date;this.fetchNumber++;this.fetchInProgress=!0;var a=this;d3.json(this.url,function(f){f["accepted conn"]-=a.fetchNumber;a.previousData=a.data;a.data=f;a.fetchInProgress=!1;b&&b(a)})}return this};this.get=function(){this.lastFetch+this.delay<+new Date&&this.fetch();return this.data};this.getPrevious=function(){return this.previousData};return this};
d.monitoring=function(g,c,b){this.context=cubism.context().serverDelay(0).clientDelay(0).step(c).size(b);this.title=null;this.context.on("focus",function(a){d3.selectAll(".value").style("right",null==a?null:b-a+"px")});this.start=+new Date;this.status=d.status(g,c);this.getMetric=function(a,f){var b=this;return this.context.metric(function(h,e,f,c){e=[];h>=b.start&&(h=b.status.data[a])&&e.push(h);c(null,e)},f?f:a)};this.getDiffMetric=function(a,b){var c=this;return this.context.metric(function(b,
e,f,d){e=[];b>=c.start&&(b=c.status.data[a]-c.status.previousData[a])&&e.push(b);d(null,e)},b)};this.getData=function(){var a=this.monitoring.status.get();this.title&&this.title.text("Pool "+a.pool+" ("+a["process manager"]+") started since "+new Date(1E3*a["start time"]));return[this.getMetric("accepted conn","total conn"),this.getDiffMetric("accepted conn","new conn"),this.getMetric("active processes"),this.getDiffMetric("active processes","~ active processes"),this.getMetric("idle processes"),
this.getDiffMetric("idle processes","~ idle processes"),this.getMetric("total processes"),this.getDiffMetric("total processes","~ total processes"),this.getMetric("max active processes"),this.getMetric("max children reached"),this.getMetric("listen queue"),this.getDiffMetric("listen queue","~ listen queue"),this.getMetric("max listen queue")]};this.display=function(a,b){this.start=+new Date;if(a=d3.select(a)){var c="phpfpm";b&&(c+=" "+b);a.attr("class",c);this.title=a.append("h1").attr("class","title");
var d=a.append("div").attr("class","graphe"),e=this;d.call(function(a){d.append("div").attr("class","axis").call(e.context.axis().orient("top"));d.selectAll(".horizon").data(e.getData()).enter().append("div").attr("class",function(a){return"horizon "+a.toString().replace(/\s+/g,"")}).call(function(a){return a=e.context.horizon().format(d3.format("d")).colors("#0d58f1 #568bf5 #9fbdfa #e8effe #feefe8 #fabd9f #f58b56 #f1580d".split(" "))(a)});d.append("div").attr("class","rule").call(e.context.rule())})}};
return this}})(cubism);
