(function(l){var d=l.phpfpm={};d.url=function(d){this.url=d;this.addQueryString=function(c,a){var b=RegExp("([?|&])"+c+"=.*?(&|#|$)(.*)","gi");b.test(this.url)?this.url=this.url.replace(b,"$1"+c+(a?"="+a:"")+"$2$3"):(b=this.url.split("#"),this.url=b[0]+(-1!==this.url.indexOf("?")?"&":"?")+c,a&&(this.url+="="+a),b[1]&&(this.url+="#"+b[1]));return this};this.toString=function(){return this.url};return this};d.status=function(f,c){this.url=d.url(f).addQueryString("json").toString();this.delay=c;this.data=
{};this.previousData={};this.dataBeforeError={};this.lastFetch=null;this.fetchNumber=0;this.fetchInProgress=!1;this.error=this.callback=null;this.fetch=function(){if(!this.fetchInProgress){this.lastFetch=+new Date;this.fetchNumber++;this.fetchInProgress=!0;var a=this;d3.json(this.url,function(b,c){b?(a.error=b,a.dataBeforeError=a.data,a.previousData={},a.data={}):(a.error?(a.error=null,a.previousData=a.dataBeforeError,a.dataBeforeError={}):a.previousData=a.data,a.previousData["accepted conn"]&&c["accepted conn"]<
a.previousData["accepted conn"]&&(a.fetchNumber=1),a.data=c,a.data["accepted conn"]-=a.fetchNumber);a.callback&&a.callback(a);a.fetchInProgress=!1})}return this};this.get=function(){var a=+new Date;(!this.lastFetch||this.lastFetch+this.delay<a)&&this.fetch();return this.data};this.getPrevious=function(){return this.previousData};return this};d.message=function(d,c){this.target=d;this.cssClass=c;this.container=null;this.show=function(a){this.container||(this.container=this.target.append("div").attr("class",
this.cssClass).style("position","absolute").style("top",0).style("left",0).style("width",this.target.style("width")).style("height",this.target.style("height")).style("line-height",this.target.style("height")).style("z-index",1));this.container.text(a);return this};this.hide=function(){this.container&&(this.container.remove(),this.container=null);return this};return this};d.monitoring=function(f,c){c||(c=1E3);this.start=+new Date;this.status=d.status(f,c);this.context=cubism.context().serverDelay(0).clientDelay(0).step(c);
this.getMetric=function(a,b){var c=this;return this.context.metric(function(b,d,g,e){var h=[];b=+b;if(b>=c.start)for(d=+d;b<d;){b+=g;var k=c.status.get()[a];k&&h.push(k)}e(null,h)},b?b:a)};this.getDiffMetric=function(a,b){var c=this;return this.context.metric(function(b,d,g,e){var h=[];b=+b;if(b>=c.start)for(d=+d;b<d;){b+=g;var k=c.status.get()[a]-c.status.getPrevious()[a];k&&h.push(k)}e(null,h)},b)};this.getData=function(){return[this.getMetric("accepted conn","total conn"),this.getDiffMetric("accepted conn",
"~ total conn"),this.getMetric("active processes"),this.getDiffMetric("active processes","~ active processes"),this.getMetric("idle processes"),this.getDiffMetric("idle processes","~ idle processes"),this.getMetric("total processes"),this.getDiffMetric("total processes","~ total processes"),this.getMetric("max active processes"),this.getMetric("max children reached"),this.getMetric("listen queue"),this.getDiffMetric("listen queue","~ listen queue"),this.getMetric("max listen queue")]};this.display=
function(a,b){if(a=d3.select(a)){this.start=+new Date;var c=parseInt(a.style("width"),10);this.context.size(c).on("focus",function(a){d3.selectAll(".value").style("right",null==a?null:c-a+"px")});var f="phpfpm";b&&(f+=" "+b);a.attr("class",f).attr("position","relative");var l=a.append("h1").attr("class","title"),g=d.message(a,"error");this.status.callback=function(a){a.error?g.show("Error: "+a.error):(g.hide(),l.text("Pool "+a.data.pool+" ("+a.data["process manager"]+") started since "+new Date(1E3*
a.data["start time"])))};this.status.fetch();var e=this;a.append("div").attr("class","graphe").call(function(a){a.append("div").attr("class","axis").call(e.context.axis().orient("top"));a.selectAll(".horizon").data(e.getData()).enter().append("div").attr("class",function(a){return"horizon "+a.toString().replace(/\s+/g,"")}).call(function(a){return e.context.horizon().format(d3.format("d")).colors("#0d58f1 #568bf5 #9fbdfa #e8effe #feefe8 #fabd9f #f58b56 #f1580d".split(" "))(a)});a.append("div").attr("class",
"rule").call(e.context.rule())})}return this};return this}})(cubism);
